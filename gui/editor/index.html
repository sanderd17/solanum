<html>
  <head>
    <meta charset="utf-8" />
    <title>Editor</title>
    <script src="./svgedit/jquery.min.js"></script>
    <script src="./svgedit/jquery-ui/jquery-ui-1.8.17.custom.min.js"></script>
    <style> #svgroot { overflow: hidden; } </style>
  </head>

  <body>
    <h1>Minimal demo of SvgCanvas</h1>

    <div id="editorContainer"></div>

    <div>
      [<button onclick="canvas.setMode('select')">Select</button>
      <button onclick="canvas.setMode('circle')">Circle</button>
      <button onclick="canvas.setMode('rect')">Rect</button>]
      <button onclick="fill('#ff0000')">Fill Red</button>
      <button onclick="canvas.deleteSelectedElements()">Delete Selected</button>
      <button onclick="canvas.clear(); canvas.updateCanvas(width, height);">Clear All</button>
      <button onclick="alert(canvas.getSvgString())">Get SVG</button>
      <button onclick="saveSvg('test', canvas.getSvgString())">Save</button>
    </div>
    <ul id="componentList">

    </ul>
    <script>
      function saveSvg(name, svg) {
        fetch('/API/Editor/saveComponent', {
          method: 'POST',
          body: JSON.stringify({
            name: name,
            svg: svg
          }),
          headers:{
            'Content-Type': 'application/json'
          }
        })
      }
    </script>

    <script type="module">
import SvgCanvas from './svgedit/svgcanvas.js';

const container = document.querySelector('#editorContainer');
const {width, height} = {width: 500, height: 300};
window.width = width;
window.height = height;

const config = {
  initFill: {color: 'FFFFFF', opacity: 1},
  initStroke: {color: '000000', opacity: 1, width: 1},
  text: {stroke_width: 0, font_size: 24, font_family: 'serif'},
  initOpacity: 1,
  imgPath: 'editor/images/',
  dimensions: [width, height],
  baseUnit: 'px',
};

window.canvas = new SvgCanvas(container, config);
canvas.updateCanvas(width, height);

window.fill = function (colour) {
  canvas.getSelectedElems().forEach((el) => {
    el.setAttribute('fill', colour);
  });
};

fetch('../API/Editor/getComponentPaths')
  .then(async response => {
    const components = await response.json()
    const ul = document.getElementById('componentList')
    for (let cmp of components) {
      let li = document.createElement('li')
      li.textContent = cmp
      li.onclick = async () => {
        const module = await import('/templates/' + cmp)
        /** @type {typeof Template} */
        const cmpClass = module.default
        const [w, h] = cmpClass.prototype.size
        const inst = new cmpClass(null, '', {width: w, height: h, x:0, y:0})
        const svg = inst.render()
        console.log(svg)
        canvas.setSvgString(svg, false)
        canvas.setResolution(w, h)
        canvas.updateCanvas(w, h)
      }
      ul.appendChild(li)
    }
  })
    </script>
  </body>
</html>
